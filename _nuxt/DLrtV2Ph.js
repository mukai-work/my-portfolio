import{_ as x,e as I,h as k,p as H,z as W,c as b,A as Z,j as J,a as y,F as A,B as C,o as w,C as Q,t as j,b as X,k as B,D as Y,i as ee,d as K,E as te}from"./C3uF1IN0.js";const ne=(a,n,r)=>{const o=a[n];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((u,l)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(l.bind(null,new Error("Unknown variable dynamic import: "+n+(n.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})};function L(){const a=new Uint32Array(4);return crypto.getRandomValues(a),Array.from(a).map(n=>n.toString(36)).join("")}function N(a){let n=0;for(const r of a)n=n*31+r.charCodeAt(0)>>>0;return n===0&&(n=1),()=>(n^=n<<13,n^=n>>>17,n^=n<<5,n>>>0)}function G(a,n){return a()%n}function O(a,n){for(let r=n.length-1;r>0;r--){const o=G(a,r+1);[n[r],n[o]]=[n[o],n[r]]}return n}function oe(a,n,r,o){for(let e=0;e<9;e++)if(a[n][e]===o||a[e][r]===o)return!1;const u=Math.floor(n/3)*3,l=Math.floor(r/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(a[u+e][l+t]===o)return!1;return!0}function re(a,n=2){const r=a.map(l=>[...l]);let o=0;const u=(l=0)=>{if(o>=n)return;if(l===81){o++;return}const e=Math.floor(l/9),t=l%9;if(r[e][t]!==0){u(l+1);return}for(let f=1;f<=9&&o<n;f++)oe(r,e,t,f)&&(r[e][t]=f,u(l+1));r[e][t]=0};return u(),o===0?"none":o===1?"unique":"multiple"}function le(){return Array.from({length:9},()=>Array(9).fill(!1))}function _(a){const n=le(),r=Array.from({length:9},()=>Array(10).fill(-1)),o=Array.from({length:9},()=>Array(10).fill(-1)),u=Array.from({length:9},()=>Array(10).fill(-1));for(let l=0;l<9;l++)for(let e=0;e<9;e++){const t=a[l][e];if(t===0)continue;const f=Math.floor(l/3)*3+Math.floor(e/3);if(r[l][t]!==-1?n[l][e]=n[l][r[l][t]]=!0:r[l][t]=e,o[e][t]!==-1?n[l][e]=n[o[e][t]][e]=!0:o[e][t]=l,u[f][t]!==-1){const s=Math.floor(u[f][t]/9),c=u[f][t]%9;n[l][e]=n[s][c]=!0}else u[f][t]=l*9+e}return n}function U(a,n,r,o){for(let e=0;e<9;e++)if(a[n][e]===o||a[e][r]===o)return!1;const u=Math.floor(n/3)*3,l=Math.floor(r/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(a[u+e][l+t]===o)return!1;return!0}function $(a,n,r){const o=[];for(let u=1;u<=9;u++)U(a,n,r,u)&&o.push(u);return o}function se(a,n){const r=a.map(l=>[...l]);let o=0;for(;;){let l=!1;for(let e=0;e<9;e++)for(let t=0;t<9;t++){if(r[e][t]!==0)continue;const f=$(r,e,t);f.length===1&&n.includes("naked-single")&&(r[e][t]=f[0],o+=1,l=!0)}if(!l){if(n.includes("hidden-single")){for(let e=0;e<27&&!l;e++){const t=[];if(e<9)for(let s=0;s<9;s++)t.push({r:e,c:s});else if(e<18)for(let s=0;s<9;s++)t.push({r:s,c:e-9});else{const s=Math.floor((e-18)/3)*3,c=(e-18)%3*3;for(let p=0;p<3;p++)for(let m=0;m<3;m++)t.push({r:s+p,c:c+m})}const f=Array.from({length:10},()=>[]);for(const{r:s,c}of t)if(r[s][c]===0)for(const p of $(r,s,c))f[p].push(s*9+c);for(let s=1;s<=9;s++)if(f[s].length===1){const c=f[s][0],p=Math.floor(c/9),m=c%9;r[p][m]=s,o+=1,l=!0;break}}if(l)continue}break}}return{status:r.every(l=>l.every(e=>e!==0))?"solved":"stuck",rating:o}}function ie(a){switch(a){case"easy":return["naked-single","hidden-single"];case"normal":return["naked-single","hidden-single","locked","naked-pair"];case"hard":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing"];case"expert":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing","xy-wing"];case"oni":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing","xy-wing","swordfish"];default:return["naked-single","hidden-single"]}}function ae(){return Array.from({length:9},()=>Array(9).fill(0))}function ue(a,n,r,o){for(let e=0;e<9;e++)if(a[n][e]===o||a[e][r]===o)return!1;const u=Math.floor(n/3)*3,l=Math.floor(r/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(a[u+e][l+t]===o)return!1;return!0}function E(a,n,r=0){if(r===81)return!0;const o=Math.floor(r/9),u=r%9;if(a[o][u]!==0)return E(a,n,r+1);const l=O(n,[1,2,3,4,5,6,7,8,9]);for(const e of l)if(ue(a,o,u,e)){if(a[o][u]=e,E(a,n,r+1))return!0;a[o][u]=0}return!1}function ce(a,n,r){const o=a.map(l=>[...l]),u=O(n,Array.from({length:81},(l,e)=>e));for(const l of u){const e=Math.floor(l/9),t=l%9,f=o[e][t];if(o[e][t]=0,re(o,2)!=="unique"&&(o[e][t]=f),o.flat().filter(c=>c!==0).length<=r)break}return o}async function fe(a){const r=(await ne(Object.assign({"../data/bank/easy.json":()=>x(()=>import("./Cdf7bSM1.js"),[],import.meta.url),"../data/bank/expert.json":()=>x(()=>import("./bQ4ZPnbs.js"),[],import.meta.url),"../data/bank/hard.json":()=>x(()=>import("./DiHkrW1l.js"),[],import.meta.url),"../data/bank/normal.json":()=>x(()=>import("./BKPcU9vJ.js"),[],import.meta.url),"../data/bank/oni.json":()=>x(()=>import("./DEojRT7t.js"),[],import.meta.url)}),`../data/bank/${a}.json`,4)).default,o="bank",u=r[G(N(L()),r.length)],l=u.map(e=>e.map(t=>t!==0));return{grid:u,givens:l,seed:o,difficulty:a,rating:0}}const de={easy:40,normal:35,hard:30,expert:25,oni:22};async function ve(a){const n=Date.now(),r=L(),o=N(r),u=ae();E(u,o);const l=de[a],e=ce(u,o,l),t=se(e,ie(a));if(t.status!=="solved"||Date.now()-n>2500)return await fe(a);const f=e.map(s=>s.map(c=>c!==0));return{grid:e,givens:f,seed:r,difficulty:a,rating:t.rating}}const pe={class:"relative",style:{width:"min(92vw,560px)",height:"min(92vw,560px)"}},ye={class:"grid grid-cols-9 grid-rows-9 w-full h-full"},me=["onClick"],he={class:"mt-2 grid grid-cols-12 gap-2",style:{width:"min(92vw,560px)"}},ke=["onClick"],ge=I({__name:"SudokuBoard",props:{difficulty:{},showErrors:{type:Boolean}},emits:["new"],setup(a,{expose:n,emit:r}){const o=a,u=r;function l(){return Array.from({length:9},()=>Array(9).fill(0))}const e=k(null),t=k(l()),f=k([]),s=k(null),c=k([]),p=k([]),m=k(_(t.value));async function M(){const i=await ve(o.difficulty);e.value=i,t.value=i.grid.map(d=>[...d]),f.value=i.givens.map(d=>[...d]),m.value=_(t.value),s.value=null,c.value=[],p.value=[],u("new",i)}H(()=>o.difficulty,()=>{M()}),n({newGame:M});function q(i,d){s.value={r:i,c:d}}function V(i){if(!s.value)return;const{r:d,c:v}=s.value;if(f.value[d][v]||!U(t.value,d,v,i))return;const h=t.value[d][v];t.value[d][v]=i,c.value.push({r:d,c:v,prev:h,next:i}),p.value=[],m.value=_(t.value)}function z(){if(!s.value)return;const{r:i,c:d}=s.value;if(f.value[i][d])return;const v=t.value[i][d];v!==0&&(t.value[i][d]=0,c.value.push({r:i,c:d,prev:v,next:0}),p.value=[],m.value=_(t.value))}function D(){const i=c.value.pop();i&&(t.value[i.r][i.c]=i.prev,p.value.push(i),m.value=_(t.value))}function S(){const i=p.value.pop();i&&(t.value[i.r][i.c]=i.next,c.value.push(i),m.value=_(t.value))}function F(i){if(!s.value)return;const{r:d,c:v}=s.value;i.key>="1"&&i.key<="9"?V(parseInt(i.key)):i.key==="0"||i.key==="Backspace"?z():i.key==="ArrowUp"||i.key==="w"||i.key==="W"?s.value={r:(d+8)%9,c:v}:i.key==="ArrowDown"||i.key==="s"||i.key==="S"?s.value={r:(d+1)%9,c:v}:i.key==="ArrowLeft"||i.key==="a"||i.key==="A"?s.value={r:d,c:(v+8)%9}:i.key==="ArrowRight"||i.key==="d"||i.key==="D"?s.value={r:d,c:(v+1)%9}:(i.ctrlKey||i.metaKey)&&i.key==="z"?D():(i.ctrlKey||i.metaKey)&&(i.key==="y"||i.shiftKey&&i.key==="Z")&&S()}return W(()=>M()),(i,d)=>(w(),b("div",{class:"inline-block",onKeydown:d[0]||(d[0]=Z(J(()=>{},["prevent"]),["tab"])),onKeydownCapture:F,tabindex:"0"},[y("div",pe,[y("div",ye,[(w(!0),b(A,null,C(t.value,(v,h)=>(w(),b(A,{key:h},[(w(!0),b(A,null,C(v,(P,g)=>{var R,T;return w(),b("button",{key:g,onClick:Ae=>q(h,g),class:Q(["border border-gray-400 flex items-center justify-center select-none","text-lg",h%3===0?"border-t-2":"",g%3===0?"border-l-2":"",h===8?"border-b-2":"",g===8?"border-r-2":"",((R=s.value)==null?void 0:R.r)===h&&((T=s.value)==null?void 0:T.c)===g?"bg-yellow-200":s.value&&(s.value.r===h||s.value.c===g)?"bg-yellow-100":"",f.value[h][g]?"font-bold":"",o.showErrors&&m.value[h][g]?"bg-red-200":"",s.value&&t.value[s.value.r][s.value.c]!==0&&t.value[s.value.r][s.value.c]===P?"bg-blue-100":""])},j(P||""),11,me)}),128))],64))),128))])]),y("div",he,[(w(),b(A,null,C(9,v=>y("button",{key:v,class:"p-2 bg-white border rounded",onClick:h=>V(v)},j(v),9,ke)),64)),y("button",{class:"p-2 bg-white border rounded",onClick:z},"消"),y("button",{class:"p-2 bg-white border rounded",onClick:D},"Undo"),y("button",{class:"p-2 bg-white border rounded",onClick:S},"Redo")])],32))}}),be={class:"min-h-screen p-4 flex flex-col items-center justify-center gap-4"},we={class:"flex flex-wrap gap-2 items-center justify-center"},_e={class:"flex items-center gap-1"},xe={class:"text-sm flex items-center gap-1"},Ce=I({__name:"sudoku",setup(a){const n=k("easy"),r=k(!0),o=k(""),u=k(null);function l(s){o.value=s.seed}function e(){var s;(s=u.value)==null||s.newGame()}function t(){document.documentElement.classList.toggle("dark")}async function f(){await navigator.clipboard.writeText(o.value)}return(s,c)=>(w(),b("div",be,[y("div",we,[B(y("select",{"onUpdate:modelValue":c[0]||(c[0]=p=>n.value=p),class:"border p-1"},c[2]||(c[2]=[ee('<option value="easy">やさしい</option><option value="normal">ふつう</option><option value="hard">むずかしい</option><option value="expert">エキスパート</option><option value="oni">鬼</option>',5)]),512),[[Y,n.value]]),y("button",{class:"border p-1",onClick:e},"新規作成"),y("label",_e,[B(y("input",{type:"checkbox","onUpdate:modelValue":c[1]||(c[1]=p=>r.value=p)},null,512),[[te,r.value]]),c[3]||(c[3]=K(" エラーハイライト "))]),y("button",{class:"border p-1",onClick:t},"テーマ切替"),y("div",xe,[K(" Seed: "+j(o.value)+" ",1),y("button",{class:"border px-1",onClick:f},"コピー")])]),X(ge,{ref_key:"board",ref:u,difficulty:n.value,"show-errors":r.value,onNew:l},null,8,["difficulty","show-errors"])]))}});export{Ce as default};
