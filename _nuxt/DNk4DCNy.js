import{_ as w,e as L,h,z as R,p as Z,A as J,c as g,B as Q,j as X,a as b,l as Y,F as C,C as M,o as k,D as j,t as E,b as ee,k as te,d as I,E as re}from"./jMY1ho4J.js";const ne=(u,r,l)=>{const n=u[r];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((i,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+r+(r.split("/").length!==l?". Note that variables only represent file names one level deep.":""))))})};function O(){const u=new Uint32Array(4);return crypto.getRandomValues(u),Array.from(u).map(r=>r.toString(36)).join("")}function G(u){let r=0;for(const l of u)r=r*31+l.charCodeAt(0)>>>0;return r===0&&(r=1),()=>(r^=r<<13,r^=r>>>17,r^=r<<5,r>>>0)}function q(u,r){return u()%r}function U(u,r){for(let l=r.length-1;l>0;l--){const n=q(u,l+1);[r[l],r[n]]=[r[n],r[l]]}return r}function oe(u,r,l,n){for(let e=0;e<9;e++)if(u[r][e]===n||u[e][l]===n)return!1;const i=Math.floor(r/3)*3,a=Math.floor(l/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(u[i+e][a+t]===n)return!1;return!0}function le(u,r=2){const l=u.map(a=>[...a]);let n=0;const i=(a=0)=>{if(n>=r)return;if(a===81){n++;return}const e=Math.floor(a/9),t=a%9;if(l[e][t]!==0){i(a+1);return}for(let c=1;c<=9&&n<r;c++)oe(l,e,t,c)&&(l[e][t]=c,i(a+1));l[e][t]=0};return i(),n===0?"none":n===1?"unique":"multiple"}function ae(){return Array.from({length:9},()=>Array(9).fill(!1))}function x(u){const r=ae(),l=Array.from({length:9},()=>Array(10).fill(-1)),n=Array.from({length:9},()=>Array(10).fill(-1)),i=Array.from({length:9},()=>Array(10).fill(-1));for(let a=0;a<9;a++)for(let e=0;e<9;e++){const t=u[a][e];if(t===0)continue;const c=Math.floor(a/3)*3+Math.floor(e/3);if(l[a][t]!==-1?r[a][e]=r[a][l[a][t]]=!0:l[a][t]=e,n[e][t]!==-1?r[a][e]=r[n[e][t]][e]=!0:n[e][t]=a,i[c][t]!==-1){const s=Math.floor(i[c][t]/9),f=i[c][t]%9;r[a][e]=r[s][f]=!0}else i[c][t]=a*9+e}return r}function se(u,r,l,n){for(let e=0;e<9;e++)if(u[r][e]===n||u[e][l]===n)return!1;const i=Math.floor(r/3)*3,a=Math.floor(l/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(u[i+e][a+t]===n)return!1;return!0}function N(u,r,l){const n=[];for(let i=1;i<=9;i++)se(u,r,l,i)&&n.push(i);return n}function ue(u,r){const l=u.map(a=>[...a]);let n=0;for(;;){let a=!1;for(let e=0;e<9;e++)for(let t=0;t<9;t++){if(l[e][t]!==0)continue;const c=N(l,e,t);c.length===1&&r.includes("naked-single")&&(l[e][t]=c[0],n+=1,a=!0)}if(!a){if(r.includes("hidden-single")){for(let e=0;e<27&&!a;e++){const t=[];if(e<9)for(let s=0;s<9;s++)t.push({r:e,c:s});else if(e<18)for(let s=0;s<9;s++)t.push({r:s,c:e-9});else{const s=Math.floor((e-18)/3)*3,f=(e-18)%3*3;for(let p=0;p<3;p++)for(let m=0;m<3;m++)t.push({r:s+p,c:f+m})}const c=Array.from({length:10},()=>[]);for(const{r:s,c:f}of t)if(l[s][f]===0)for(const p of N(l,s,f))c[p].push(s*9+f);for(let s=1;s<=9;s++)if(c[s].length===1){const f=c[s][0],p=Math.floor(f/9),m=f%9;l[p][m]=s,n+=1,a=!0;break}}if(a)continue}break}}return{status:l.every(a=>a.every(e=>e!==0))?"solved":"stuck",rating:n}}function ie(u){switch(u){case"easy":return["naked-single","hidden-single"];case"normal":return["naked-single","hidden-single","locked","naked-pair"];case"hard":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing"];case"expert":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing","xy-wing"];case"oni":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing","xy-wing","swordfish"];default:return["naked-single","hidden-single"]}}function ce(){return Array.from({length:9},()=>Array(9).fill(0))}function fe(u,r,l,n){for(let e=0;e<9;e++)if(u[r][e]===n||u[e][l]===n)return!1;const i=Math.floor(r/3)*3,a=Math.floor(l/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(u[i+e][a+t]===n)return!1;return!0}function z(u,r,l=0){if(l===81)return!0;const n=Math.floor(l/9),i=l%9;if(u[n][i]!==0)return z(u,r,l+1);const a=U(r,[1,2,3,4,5,6,7,8,9]);for(const e of a)if(fe(u,n,i,e)){if(u[n][i]=e,z(u,r,l+1))return!0;u[n][i]=0}return!1}function de(u,r,l){const n=u.map(a=>[...a]),i=U(r,Array.from({length:81},(a,e)=>e));for(const a of i){const e=Math.floor(a/9),t=a%9,c=n[e][t];if(n[e][t]=0,le(n,2)!=="unique"&&(n[e][t]=c),n.flat().filter(f=>f!==0).length<=l)break}return n}async function ve(u){const l=(await ne(Object.assign({"../data/bank/easy.json":()=>w(()=>import("./Cdf7bSM1.js"),[],import.meta.url),"../data/bank/expert.json":()=>w(()=>import("./bQ4ZPnbs.js"),[],import.meta.url),"../data/bank/hard.json":()=>w(()=>import("./DiHkrW1l.js"),[],import.meta.url),"../data/bank/normal.json":()=>w(()=>import("./BKPcU9vJ.js"),[],import.meta.url),"../data/bank/oni.json":()=>w(()=>import("./DEojRT7t.js"),[],import.meta.url)}),`../data/bank/${u}.json`,4)).default,n="bank",i=l[q(G(O()),l.length)],a=i.map(e=>e.map(t=>t!==0));return{grid:i,givens:a,seed:n,difficulty:u,rating:0}}const be={easy:40,normal:35,hard:30,expert:25,oni:22};async function pe(u){const r=Date.now(),l=O(),n=G(l),i=ce();z(i,n);const a=be[u],e=de(i,n,a),t=ue(e,ie(u));if(t.status!=="solved"||Date.now()-r>2500)return await ve(u);const c=e.map(s=>s.map(f=>f!==0));return{grid:e,givens:c,seed:l,difficulty:u,rating:t.rating}}const me={class:"flex gap-4"},ye={class:"relative",style:{width:"min(92vw,560px)",height:"min(92vw,560px)"}},he={class:"w-full h-full border-[3px] border-[var(--muted)] border-collapse table-fixed"},ge=["onClick"],ke={key:0,class:"absolute inset-0 flex items-center justify-center bg-black/20 text-4xl font-bold text-green-600"},_e={class:"flex flex-col items-center gap-4"},xe={class:"grid grid-cols-3 gap-2"},we=["disabled","onClick"],Ae=L({__name:"SudokuBoard",props:{difficulty:{},showErrors:{type:Boolean}},emits:["new"],setup(u,{expose:r,emit:l}){const n=u,i=l;function a(){return Array.from({length:9},()=>Array(9).fill(0))}const e=h(null),t=h(a()),c=h([]),s=h(null),f=h([]),p=h([]),m=h(x(t.value)),F=R(()=>t.value.every(o=>o.every(d=>d!==0))),D=R(()=>{const o=Array(10).fill(0);for(const d of t.value)for(const v of d)v!==0&&o[v]++;return o});async function A(){const o=await pe(n.difficulty);e.value=o,t.value=o.grid.map(d=>[...d]),c.value=o.givens.map(d=>[...d]),m.value=x(t.value),s.value=null,f.value=[],p.value=[],i("new",o)}Z(()=>n.difficulty,()=>{A()}),r({newGame:A});function H(o,d){s.value={r:o,c:d}}function $(o){if(!s.value)return;const{r:d,c:v}=s.value;if(c.value[d][v])return;const y=t.value[d][v];y!==o&&D.value[o]>=9||(t.value[d][v]=o,f.value.push({r:d,c:v,prev:y,next:o}),p.value=[],m.value=x(t.value))}function S(){if(!s.value)return;const{r:o,c:d}=s.value;if(c.value[o][d])return;const v=t.value[o][d];v!==0&&(t.value[o][d]=0,f.value.push({r:o,c:d,prev:v,next:0}),p.value=[],m.value=x(t.value))}function T(){const o=f.value.pop();o&&(t.value[o.r][o.c]=o.prev,p.value.push(o),m.value=x(t.value))}function B(){const o=p.value.pop();o&&(t.value[o.r][o.c]=o.next,f.value.push(o),m.value=x(t.value))}function W(o){if(!s.value)return;const{r:d,c:v}=s.value;o.key>="1"&&o.key<="9"?$(parseInt(o.key)):o.key==="0"||o.key==="Backspace"?S():o.key==="ArrowUp"||o.key==="w"||o.key==="W"?s.value={r:(d+8)%9,c:v}:o.key==="ArrowDown"||o.key==="s"||o.key==="S"?s.value={r:(d+1)%9,c:v}:o.key==="ArrowLeft"||o.key==="a"||o.key==="A"?s.value={r:d,c:(v+8)%9}:o.key==="ArrowRight"||o.key==="d"||o.key==="D"?s.value={r:d,c:(v+1)%9}:(o.ctrlKey||o.metaKey)&&o.key==="z"?T():(o.ctrlKey||o.metaKey)&&(o.key==="y"||o.shiftKey&&o.key==="Z")&&B()}return J(()=>A()),(o,d)=>(k(),g("div",{class:"inline-block",onKeydown:d[0]||(d[0]=Q(X(()=>{},["prevent"]),["tab"])),onKeydownCapture:W,tabindex:"0"},[b("div",me,[b("div",ye,[b("table",he,[b("tbody",null,[(k(!0),g(C,null,M(t.value,(v,y)=>(k(),g("tr",{key:y},[(k(!0),g(C,null,M(v,(V,_)=>{var K,P;return k(),g("td",{key:_,class:j(["p-0",(y+1)%3===0?"border-b-[3px] border-b-[var(--fg)]":"border-b border-b-[var(--border)]",(_+1)%3===0?"border-r-[3px] border-r-[var(--fg)]":"border-r border-r-[var(--border)]"])},[b("button",{onClick:ze=>H(y,_),class:j(["w-full h-full flex items-center justify-center select-none text-lg bg-[var(--surface)] border-none p-0",[s.value&&(s.value.r===y||s.value.c===_)?"bg-blue-50 dark:bg-blue-900":"",((K=s.value)==null?void 0:K.r)===y&&((P=s.value)==null?void 0:P.c)===_?"bg-blue-200 dark:bg-blue-700":"",c.value[y][_]?"font-bold":"",!c.value[y][_]&&V!==0?"text-blue-700 dark:text-blue-400":"",s.value&&t.value[s.value.r][s.value.c]!==0&&t.value[s.value.r][s.value.c]===V?"bg-blue-100 dark:bg-blue-700":"",n.showErrors&&m.value[y][_]?"bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400":""]])},E(V||""),11,ge)],2)}),128))]))),128))])]),F.value?(k(),g("div",ke," Done! ")):Y("",!0)]),b("div",_e,[b("div",{class:"flex flex-col gap-2"},[b("button",{class:"p-2 bg-[var(--surface)] border border-[var(--border)] rounded w-12 h-12",onClick:S},"消"),b("button",{class:"p-2 bg-[var(--surface)] border border-[var(--border)] rounded w-12 h-12",onClick:T},"戻す"),b("button",{class:"p-2 bg-[var(--surface)] border border-[var(--border)] rounded w-12 h-12",onClick:B},"やり直し")]),b("div",xe,[(k(),g(C,null,M(9,v=>b("button",{key:v,class:j(["p-2 bg-[var(--surface)] border border-[var(--border)] rounded w-12 h-12 flex items-center justify-center",D.value[v]>=9?"opacity-50 cursor-not-allowed":""]),disabled:D.value[v]>=9,onClick:y=>$(v)},E(v),11,we)),64))]),b("button",{class:"p-2 bg-blue-500 dark:bg-blue-600 text-white border border-[var(--border)] rounded w-full",onClick:A},"新規ゲーム")])])],32))}}),Ce={class:"min-h-screen p-4 flex flex-col items-center justify-center gap-4"},Me={class:"flex flex-wrap gap-2 items-center justify-center"},je={class:"flex flex-wrap gap-2"},Ee=["onClick"],De={class:"flex items-center gap-1"},Ve={class:"text-sm flex items-center gap-1"},Se=L({__name:"sudoku",setup(u){const r=h("easy"),l=h(!0),n=h(""),i=[{value:"easy",label:"やさしい"},{value:"normal",label:"ふつう"},{value:"hard",label:"むずかしい"},{value:"expert",label:"エキスパート"},{value:"oni",label:"鬼"}];function a(c){n.value=c.seed}function e(){const c=document.documentElement,s=c.getAttribute("data-theme");c.setAttribute("data-theme",s==="dark"?"light":"dark")}async function t(){await navigator.clipboard.writeText(n.value)}return(c,s)=>(k(),g("div",Ce,[b("div",Me,[b("div",je,[(k(),g(C,null,M(i,f=>b("button",{key:f.value,class:j(["px-2 py-1 border border-[var(--border)] rounded",f.value===r.value?"bg-blue-500 text-white dark:bg-blue-600":"bg-[var(--surface)]"]),onClick:p=>r.value=f.value},E(f.label),11,Ee)),64))]),b("label",De,[te(b("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=f=>l.value=f)},null,512),[[re,l.value]]),s[1]||(s[1]=I(" エラーハイライト "))]),b("button",{class:"border border-[var(--border)] p-1 bg-[var(--surface)]",onClick:e},"テーマ切替"),b("div",Ve,[I(" Seed: "+E(n.value)+" ",1),b("button",{class:"border border-[var(--border)] px-1 bg-[var(--surface)]",onClick:t},"コピー")])]),ee(Ae,{difficulty:r.value,"show-errors":l.value,onNew:a},null,8,["difficulty","show-errors"])]))}});export{Se as default};
