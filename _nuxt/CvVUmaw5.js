import{e as U,M as A,N as V,h as b,A as F,O as E,c as d,H as _,a as n,t as h,F as D,C,j as f,k as S,v as k,o as l}from"./DjzompB6.js";import{u as H}from"./CQN7tfLj.js";import"./wSbNHcIL.js";const I={key:0,class:"p-4"},L={class:"text-2xl mb-4"},O={class:"flex gap-4 overflow-x-auto"},P={class:"font-bold mb-2"},j=["onDrop"],q=["onDragstart"],G=["onSubmit"],J=["onUpdate:modelValue"],K={class:"w-64"},R={key:1,class:"p-4"},Y=U({__name:"[id]",async setup(z){let c,x;const w=A(),{data:s}=([c,x]=V(()=>H(`/api/boards/${w.params.id}`,"$PyGKqM0HTI")),c=await c,x(),c),p=b(null),m=b({}),v=b(""),g=async()=>{s.value&&await $fetch(`/api/boards/${s.value.id}`,{method:"PUT",body:s.value})},M=(o,a,e)=>{var t;p.value={columnId:o,cardId:a},(t=e.dataTransfer)==null||t.setData("text/plain",a)},$=o=>{if(!p.value||!s.value)return;const{columnId:a,cardId:e}=p.value,t=s.value.columns.find(u=>u.id===a),r=s.value.columns.find(u=>u.id===o);if(!t||!r)return;const y=t.cards.findIndex(u=>u.id===e);if(y===-1)return;const[T]=t.cards.splice(y,1);r.cards.push(T),p.value=null,g()},N=o=>{var t;if(!s.value)return;const a=(t=m.value[o])==null?void 0:t.trim();if(!a)return;const e=s.value.columns.find(r=>r.id===o);e&&(e.cards.push({id:Math.random().toString(36).slice(2,9),title:a}),m.value[e.id]="",g())},B=()=>{if(!s.value)return;const o=v.value.trim();o&&(s.value.columns.push({id:Math.random().toString(36).slice(2,9),name:o,cards:[]}),v.value="",g())};let i=null;return F(()=>{i=new EventSource(`/api/boards/${w.params.id}/stream`),i.onmessage=o=>{s.value=JSON.parse(o.data)}}),E(()=>{i==null||i.close()}),(o,a)=>_(s)?(l(),d("div",I,[n("h1",L,h(_(s).name),1),n("div",O,[(l(!0),d(D,null,C(_(s).columns,e=>(l(),d("div",{key:e.id,class:"w-64 bg-gray-100 p-2 rounded"},[n("h2",P,h(e.name),1),n("ul",{onDragover:a[0]||(a[0]=f(()=>{},["prevent"])),onDrop:f(t=>$(e.id),["prevent"])},[(l(!0),d(D,null,C(e.cards,t=>(l(),d("li",{key:t.id,class:"bg-white p-2 mb-2 rounded shadow",draggable:"true",onDragstart:r=>M(e.id,t.id,r)},h(t.title),41,q))),128))],40,j),n("form",{onSubmit:f(t=>N(e.id),["prevent"]),class:"mt-2 flex gap-2"},[S(n("input",{"onUpdate:modelValue":t=>m.value[e.id]=t,placeholder:"New task",class:"border p-1 flex-1"},null,8,J),[[k,m.value[e.id]]]),a[2]||(a[2]=n("button",{type:"submit",class:"bg-green-500 text-white px-2 py-1 rounded"}," Add ",-1))],40,G)]))),128)),n("div",K,[n("form",{onSubmit:f(B,["prevent"]),class:"bg-gray-100 p-2 rounded flex flex-col gap-2"},[S(n("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>v.value=e),placeholder:"New column name",class:"border p-1"},null,512),[[k,v.value]]),a[3]||(a[3]=n("button",{type:"submit",class:"bg-blue-500 text-white px-2 py-1 rounded"}," Add column ",-1))],32)])])])):(l(),d("div",R,"Loading..."))}});export{Y as default};
