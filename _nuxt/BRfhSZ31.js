import{_ as x,e as I,h,p as H,z as W,c as b,A as Z,j as J,a as y,F as A,B as C,o as w,C as Q,t as j,b as X,k as K,D as Y,i as ee,d as R,E as te}from"./D43IFmZD.js";const ne=(i,n,r)=>{const o=i[n];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((u,l)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(l.bind(null,new Error("Unknown variable dynamic import: "+n+(n.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})};function L(){const i=new Uint32Array(4);return crypto.getRandomValues(i),Array.from(i).map(n=>n.toString(36)).join("")}function N(i){let n=0;for(const r of i)n=n*31+r.charCodeAt(0)>>>0;return n===0&&(n=1),()=>(n^=n<<13,n^=n>>>17,n^=n<<5,n>>>0)}function G(i,n){return i()%n}function O(i,n){for(let r=n.length-1;r>0;r--){const o=G(i,r+1);[n[r],n[o]]=[n[o],n[r]]}return n}function oe(i,n,r,o){for(let e=0;e<9;e++)if(i[n][e]===o||i[e][r]===o)return!1;const u=Math.floor(n/3)*3,l=Math.floor(r/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(i[u+e][l+t]===o)return!1;return!0}function re(i,n=2){const r=i.map(l=>[...l]);let o=0;const u=(l=0)=>{if(o>=n)return;if(l===81){o++;return}const e=Math.floor(l/9),t=l%9;if(r[e][t]!==0){u(l+1);return}for(let f=1;f<=9&&o<n;f++)oe(r,e,t,f)&&(r[e][t]=f,u(l+1));r[e][t]=0};return u(),o===0?"none":o===1?"unique":"multiple"}function le(){return Array.from({length:9},()=>Array(9).fill(!1))}function _(i){const n=le(),r=Array.from({length:9},()=>Array(10).fill(-1)),o=Array.from({length:9},()=>Array(10).fill(-1)),u=Array.from({length:9},()=>Array(10).fill(-1));for(let l=0;l<9;l++)for(let e=0;e<9;e++){const t=i[l][e];if(t===0)continue;const f=Math.floor(l/3)*3+Math.floor(e/3);if(r[l][t]!==-1?n[l][e]=n[l][r[l][t]]=!0:r[l][t]=e,o[e][t]!==-1?n[l][e]=n[o[e][t]][e]=!0:o[e][t]=l,u[f][t]!==-1){const s=Math.floor(u[f][t]/9),c=u[f][t]%9;n[l][e]=n[s][c]=!0}else u[f][t]=l*9+e}return n}function U(i,n,r,o){for(let e=0;e<9;e++)if(i[n][e]===o||i[e][r]===o)return!1;const u=Math.floor(n/3)*3,l=Math.floor(r/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(i[u+e][l+t]===o)return!1;return!0}function $(i,n,r){const o=[];for(let u=1;u<=9;u++)U(i,n,r,u)&&o.push(u);return o}function se(i,n){const r=i.map(l=>[...l]);let o=0;for(;;){let l=!1;for(let e=0;e<9;e++)for(let t=0;t<9;t++){if(r[e][t]!==0)continue;const f=$(r,e,t);f.length===1&&n.includes("naked-single")&&(r[e][t]=f[0],o+=1,l=!0)}if(!l){if(n.includes("hidden-single")){for(let e=0;e<27&&!l;e++){const t=[];if(e<9)for(let s=0;s<9;s++)t.push({r:e,c:s});else if(e<18)for(let s=0;s<9;s++)t.push({r:s,c:e-9});else{const s=Math.floor((e-18)/3)*3,c=(e-18)%3*3;for(let p=0;p<3;p++)for(let m=0;m<3;m++)t.push({r:s+p,c:c+m})}const f=Array.from({length:10},()=>[]);for(const{r:s,c}of t)if(r[s][c]===0)for(const p of $(r,s,c))f[p].push(s*9+c);for(let s=1;s<=9;s++)if(f[s].length===1){const c=f[s][0],p=Math.floor(c/9),m=c%9;r[p][m]=s,o+=1,l=!0;break}}if(l)continue}break}}return{status:r.every(l=>l.every(e=>e!==0))?"solved":"stuck",rating:o}}function ae(i){switch(i){case"easy":return["naked-single","hidden-single"];case"normal":return["naked-single","hidden-single","locked","naked-pair"];case"hard":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing"];case"expert":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing","xy-wing"];case"oni":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing","xy-wing","swordfish"];default:return["naked-single","hidden-single"]}}function ie(){return Array.from({length:9},()=>Array(9).fill(0))}function ue(i,n,r,o){for(let e=0;e<9;e++)if(i[n][e]===o||i[e][r]===o)return!1;const u=Math.floor(n/3)*3,l=Math.floor(r/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(i[u+e][l+t]===o)return!1;return!0}function E(i,n,r=0){if(r===81)return!0;const o=Math.floor(r/9),u=r%9;if(i[o][u]!==0)return E(i,n,r+1);const l=O(n,[1,2,3,4,5,6,7,8,9]);for(const e of l)if(ue(i,o,u,e)){if(i[o][u]=e,E(i,n,r+1))return!0;i[o][u]=0}return!1}function ce(i,n,r){const o=i.map(l=>[...l]),u=O(n,Array.from({length:81},(l,e)=>e));for(const l of u){const e=Math.floor(l/9),t=l%9,f=o[e][t];if(o[e][t]=0,re(o,2)!=="unique"&&(o[e][t]=f),o.flat().filter(c=>c!==0).length<=r)break}return o}async function fe(i){const r=(await ne(Object.assign({"../data/bank/easy.json":()=>x(()=>import("./Cdf7bSM1.js"),[],import.meta.url),"../data/bank/expert.json":()=>x(()=>import("./bQ4ZPnbs.js"),[],import.meta.url),"../data/bank/hard.json":()=>x(()=>import("./DiHkrW1l.js"),[],import.meta.url),"../data/bank/normal.json":()=>x(()=>import("./BKPcU9vJ.js"),[],import.meta.url),"../data/bank/oni.json":()=>x(()=>import("./DEojRT7t.js"),[],import.meta.url)}),`../data/bank/${i}.json`,4)).default,o="bank",u=r[G(N(L()),r.length)],l=u.map(e=>e.map(t=>t!==0));return{grid:u,givens:l,seed:o,difficulty:i,rating:0}}const de={easy:40,normal:35,hard:30,expert:25,oni:22};async function ve(i){const n=Date.now(),r=L(),o=N(r),u=ie();E(u,o);const l=de[i],e=ce(u,o,l),t=se(e,ae(i));if(t.status!=="solved"||Date.now()-n>2500)return await fe(i);const f=e.map(s=>s.map(c=>c!==0));return{grid:e,givens:f,seed:r,difficulty:i,rating:t.rating}}const pe={class:"relative",style:{width:"min(92vw,560px)",height:"min(92vw,560px)"}},ye={class:"grid grid-cols-9 grid-rows-9 w-full h-full"},me=["onClick"],ge={class:"mt-2 grid grid-cols-12 gap-2",style:{width:"min(92vw,560px)"}},he=["onClick"],ke=I({__name:"SudokuBoard",props:{difficulty:{},showErrors:{type:Boolean}},emits:["new"],setup(i,{expose:n,emit:r}){const o=i,u=r;function l(){return Array.from({length:9},()=>Array(9).fill(0))}const e=h(null),t=h(l()),f=h([]),s=h(null),c=h([]),p=h([]),m=h(_(t.value));async function M(){const a=await ve(o.difficulty);e.value=a,t.value=a.grid.map(d=>[...d]),f.value=a.givens.map(d=>[...d]),m.value=_(t.value),s.value=null,c.value=[],p.value=[],u("new",a)}H(()=>o.difficulty,()=>{M()}),n({newGame:M});function q(a,d){s.value={r:a,c:d}}function V(a){if(!s.value)return;const{r:d,c:v}=s.value;if(f.value[d][v]||!U(t.value,d,v,a))return;const g=t.value[d][v];t.value[d][v]=a,c.value.push({r:d,c:v,prev:g,next:a}),p.value=[],m.value=_(t.value)}function z(){if(!s.value)return;const{r:a,c:d}=s.value;if(f.value[a][d])return;const v=t.value[a][d];v!==0&&(t.value[a][d]=0,c.value.push({r:a,c:d,prev:v,next:0}),p.value=[],m.value=_(t.value))}function D(){const a=c.value.pop();a&&(t.value[a.r][a.c]=a.prev,p.value.push(a),m.value=_(t.value))}function S(){const a=p.value.pop();a&&(t.value[a.r][a.c]=a.next,c.value.push(a),m.value=_(t.value))}function F(a){if(!s.value)return;const{r:d,c:v}=s.value;a.key>="1"&&a.key<="9"?V(parseInt(a.key)):a.key==="0"||a.key==="Backspace"?z():a.key==="ArrowUp"||a.key==="w"||a.key==="W"?s.value={r:(d+8)%9,c:v}:a.key==="ArrowDown"||a.key==="s"||a.key==="S"?s.value={r:(d+1)%9,c:v}:a.key==="ArrowLeft"||a.key==="a"||a.key==="A"?s.value={r:d,c:(v+8)%9}:a.key==="ArrowRight"||a.key==="d"||a.key==="D"?s.value={r:d,c:(v+1)%9}:(a.ctrlKey||a.metaKey)&&a.key==="z"?D():(a.ctrlKey||a.metaKey)&&(a.key==="y"||a.shiftKey&&a.key==="Z")&&S()}return W(()=>M()),(a,d)=>(w(),b("div",{class:"inline-block",onKeydown:d[0]||(d[0]=Z(J(()=>{},["prevent"]),["tab"])),onKeydownCapture:F,tabindex:"0"},[y("div",pe,[y("div",ye,[(w(!0),b(A,null,C(t.value,(v,g)=>(w(),b(A,{key:g},[(w(!0),b(A,null,C(v,(P,k)=>{var T,B;return w(),b("button",{key:k,onClick:Ae=>q(g,k),class:Q(["flex items-center justify-center select-none text-lg",(Math.floor(g/3)+Math.floor(k/3))%2===0?"bg-gray-50":"bg-white",g%3===0?"border-t-2 border-t-gray-600":"border-t border-t-gray-300",k%3===0?"border-l-2 border-l-gray-600":"border-l border-l-gray-300",g===8?"border-b-2 border-b-gray-600":"",k===8?"border-r-2 border-r-gray-600":"",((T=s.value)==null?void 0:T.r)===g&&((B=s.value)==null?void 0:B.c)===k?"bg-yellow-200":s.value&&(s.value.r===g||s.value.c===k)?"bg-yellow-100":"",f.value[g][k]?"font-bold":"",o.showErrors&&m.value[g][k]?"bg-red-200":"",s.value&&t.value[s.value.r][s.value.c]!==0&&t.value[s.value.r][s.value.c]===P?"bg-blue-100":""])},j(P||""),11,me)}),128))],64))),128))])]),y("div",ge,[(w(),b(A,null,C(9,v=>y("button",{key:v,class:"p-2 bg-white border rounded",onClick:g=>V(v)},j(v),9,he)),64)),y("button",{class:"p-2 bg-white border rounded",onClick:z},"消"),y("button",{class:"p-2 bg-white border rounded",onClick:D},"戻す"),y("button",{class:"p-2 bg-white border rounded",onClick:S},"やり直し")])],32))}}),be={class:"min-h-screen p-4 flex flex-col items-center justify-center gap-4"},we={class:"flex flex-wrap gap-2 items-center justify-center"},_e={class:"flex items-center gap-1"},xe={class:"text-sm flex items-center gap-1"},Ce=I({__name:"sudoku",setup(i){const n=h("easy"),r=h(!0),o=h(""),u=h(null);function l(s){o.value=s.seed}function e(){var s;(s=u.value)==null||s.newGame()}function t(){document.documentElement.classList.toggle("dark")}async function f(){await navigator.clipboard.writeText(o.value)}return(s,c)=>(w(),b("div",be,[y("div",we,[K(y("select",{"onUpdate:modelValue":c[0]||(c[0]=p=>n.value=p),class:"border p-1"},c[2]||(c[2]=[ee('<option value="easy">やさしい</option><option value="normal">ふつう</option><option value="hard">むずかしい</option><option value="expert">エキスパート</option><option value="oni">鬼</option>',5)]),512),[[Y,n.value]]),y("button",{class:"border p-1",onClick:e},"新規作成"),y("label",_e,[K(y("input",{type:"checkbox","onUpdate:modelValue":c[1]||(c[1]=p=>r.value=p)},null,512),[[te,r.value]]),c[3]||(c[3]=R(" エラーハイライト "))]),y("button",{class:"border p-1",onClick:t},"テーマ切替"),y("div",xe,[R(" Seed: "+j(o.value)+" ",1),y("button",{class:"border px-1",onClick:f},"コピー")])]),X(ke,{ref_key:"board",ref:u,difficulty:n.value,"show-errors":r.value,onNew:l},null,8,["difficulty","show-errors"])]))}});export{Ce as default};
