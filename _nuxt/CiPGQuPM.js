import{_ as x,e as G,h as g,n as Q,y as C,z as ee,c as k,A as te,i as ne,a as y,k as E,B as I,F as A,C as S,o as b,D as oe,t as V,b as re,j as K,E as le,G as se,d as N,H as ae}from"./Bree-THm.js";import{_ as ie}from"./DlAUqK2U.js";const ue=(i,n,r)=>{const o=i[n];return o?typeof o=="function"?o():Promise.resolve(o):new Promise((u,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+n+(n.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})};function O(){const i=new Uint32Array(4);return crypto.getRandomValues(i),Array.from(i).map(n=>n.toString(36)).join("")}function U(i){let n=0;for(const r of i)n=n*31+r.charCodeAt(0)>>>0;return n===0&&(n=1),()=>(n^=n<<13,n^=n>>>17,n^=n<<5,n>>>0)}function q(i,n){return i()%n}function H(i,n){for(let r=n.length-1;r>0;r--){const o=q(i,r+1);[n[r],n[o]]=[n[o],n[r]]}return n}function ce(i,n,r,o){for(let e=0;e<9;e++)if(i[n][e]===o||i[e][r]===o)return!1;const u=Math.floor(n/3)*3,a=Math.floor(r/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(i[u+e][a+t]===o)return!1;return!0}function fe(i,n=2){const r=i.map(a=>[...a]);let o=0;const u=(a=0)=>{if(o>=n)return;if(a===81){o++;return}const e=Math.floor(a/9),t=a%9;if(r[e][t]!==0){u(a+1);return}for(let f=1;f<=9&&o<n;f++)ce(r,e,t,f)&&(r[e][t]=f,u(a+1));r[e][t]=0};return u(),o===0?"none":o===1?"unique":"multiple"}function de(){return Array.from({length:9},()=>Array(9).fill(!1))}function w(i){const n=de(),r=Array.from({length:9},()=>Array(10).fill(-1)),o=Array.from({length:9},()=>Array(10).fill(-1)),u=Array.from({length:9},()=>Array(10).fill(-1));for(let a=0;a<9;a++)for(let e=0;e<9;e++){const t=i[a][e];if(t===0)continue;const f=Math.floor(a/3)*3+Math.floor(e/3);if(r[a][t]!==-1?n[a][e]=n[a][r[a][t]]=!0:r[a][t]=e,o[e][t]!==-1?n[a][e]=n[o[e][t]][e]=!0:o[e][t]=a,u[f][t]!==-1){const l=Math.floor(u[f][t]/9),c=u[f][t]%9;n[a][e]=n[l][c]=!0}else u[f][t]=a*9+e}return n}function F(i,n,r,o){for(let e=0;e<9;e++)if(i[n][e]===o||i[e][r]===o)return!1;const u=Math.floor(n/3)*3,a=Math.floor(r/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(i[u+e][a+t]===o)return!1;return!0}function L(i,n,r){const o=[];for(let u=1;u<=9;u++)F(i,n,r,u)&&o.push(u);return o}function ve(i,n){const r=i.map(a=>[...a]);let o=0;for(;;){let a=!1;for(let e=0;e<9;e++)for(let t=0;t<9;t++){if(r[e][t]!==0)continue;const f=L(r,e,t);f.length===1&&n.includes("naked-single")&&(r[e][t]=f[0],o+=1,a=!0)}if(!a){if(n.includes("hidden-single")){for(let e=0;e<27&&!a;e++){const t=[];if(e<9)for(let l=0;l<9;l++)t.push({r:e,c:l});else if(e<18)for(let l=0;l<9;l++)t.push({r:l,c:e-9});else{const l=Math.floor((e-18)/3)*3,c=(e-18)%3*3;for(let p=0;p<3;p++)for(let m=0;m<3;m++)t.push({r:l+p,c:c+m})}const f=Array.from({length:10},()=>[]);for(const{r:l,c}of t)if(r[l][c]===0)for(const p of L(r,l,c))f[p].push(l*9+c);for(let l=1;l<=9;l++)if(f[l].length===1){const c=f[l][0],p=Math.floor(c/9),m=c%9;r[p][m]=l,o+=1,a=!0;break}}if(a)continue}break}}return{status:r.every(a=>a.every(e=>e!==0))?"solved":"stuck",rating:o}}function pe(i){switch(i){case"easy":return["naked-single","hidden-single"];case"normal":return["naked-single","hidden-single","locked","naked-pair"];case"hard":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing"];case"expert":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing","xy-wing"];case"oni":return["naked-single","hidden-single","locked","naked-pair","hidden-pair","x-wing","xy-wing","swordfish"];default:return["naked-single","hidden-single"]}}function ye(){return Array.from({length:9},()=>Array(9).fill(0))}function me(i,n,r,o){for(let e=0;e<9;e++)if(i[n][e]===o||i[e][r]===o)return!1;const u=Math.floor(n/3)*3,a=Math.floor(r/3)*3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(i[u+e][a+t]===o)return!1;return!0}function j(i,n,r=0){if(r===81)return!0;const o=Math.floor(r/9),u=r%9;if(i[o][u]!==0)return j(i,n,r+1);const a=H(n,[1,2,3,4,5,6,7,8,9]);for(const e of a)if(me(i,o,u,e)){if(i[o][u]=e,j(i,n,r+1))return!0;i[o][u]=0}return!1}function he(i,n,r){const o=i.map(a=>[...a]),u=H(n,Array.from({length:81},(a,e)=>e));for(const a of u){const e=Math.floor(a/9),t=a%9,f=o[e][t];if(o[e][t]=0,fe(o,2)!=="unique"&&(o[e][t]=f),o.flat().filter(c=>c!==0).length<=r)break}return o}async function ge(i){const r=(await ue(Object.assign({"../data/bank/easy.json":()=>x(()=>import("./Cdf7bSM1.js"),[],import.meta.url),"../data/bank/expert.json":()=>x(()=>import("./bQ4ZPnbs.js"),[],import.meta.url),"../data/bank/hard.json":()=>x(()=>import("./DiHkrW1l.js"),[],import.meta.url),"../data/bank/normal.json":()=>x(()=>import("./BKPcU9vJ.js"),[],import.meta.url),"../data/bank/oni.json":()=>x(()=>import("./DEojRT7t.js"),[],import.meta.url)}),`../data/bank/${i}.json`,4)).default,o="bank",u=r[q(U(O()),r.length)],a=u.map(e=>e.map(t=>t!==0));return{grid:u,givens:a,seed:o,difficulty:i,rating:0}}const ke={easy:40,normal:35,hard:30,expert:25,oni:22};async function be(i){const n=Date.now(),r=O(),o=U(r),u=ye();j(u,o);const a=ke[i],e=he(u,o,a),t=ve(e,pe(i));if(t.status!=="solved"||Date.now()-n>2500)return await ge(i);const f=e.map(l=>l.map(c=>c!==0));return{grid:e,givens:f,seed:r,difficulty:i,rating:t.rating}}const _e={class:"relative",style:{width:"min(92vw,560px)",height:"min(92vw,560px)"}},we={class:"grid grid-cols-9 grid-rows-9 w-full h-full"},xe=["onClick"],Ae={class:"mt-2 grid grid-cols-5 gap-2",style:{width:"min(92vw,560px)"}},Me=["onClick"],Ce={key:0,class:"mt-2"},Ee=G({__name:"SudokuBoard",props:{difficulty:{},showErrors:{type:Boolean}},emits:["new"],setup(i,{expose:n,emit:r}){const o=i,u=r;function a(){return Array.from({length:9},()=>Array(9).fill(0))}const e=g(null),t=g(a()),f=g([]),l=g(null),c=g([]),p=g([]),m=g(w(t.value));async function M(){const s=await be(o.difficulty);e.value=s,t.value=s.grid.map(d=>[...d]),f.value=s.givens.map(d=>[...d]),m.value=w(t.value),l.value=null,c.value=[],p.value=[],u("new",s)}Q(()=>o.difficulty,()=>{M()}),n({newGame:M});function W(s,d){l.value={r:s,c:d}}function z(s){if(!l.value)return;const{r:d,c:v}=l.value;if(f.value[d][v]||!F(t.value,d,v,s))return;const h=t.value[d][v];t.value[d][v]=s,c.value.push({r:d,c:v,prev:h,next:s}),p.value=[],m.value=w(t.value)}function D(){if(!l.value)return;const{r:s,c:d}=l.value;if(f.value[s][d])return;const v=t.value[s][d];v!==0&&(t.value[s][d]=0,c.value.push({r:s,c:d,prev:v,next:0}),p.value=[],m.value=w(t.value))}function $(){const s=c.value.pop();s&&(t.value[s.r][s.c]=s.prev,p.value.push(s),m.value=w(t.value))}function B(){const s=p.value.pop();s&&(t.value[s.r][s.c]=s.next,c.value.push(s),m.value=w(t.value))}const X=C(()=>l.value?{transform:`translateY(${l.value.r*100/9}%)`,height:`${100/9}%`,width:"100%"}:{}),Y=C(()=>l.value?{transform:`translateX(${l.value.c*100/9}%)`,width:`${100/9}%`,height:"100%"}:{}),Z=C(()=>t.value.length>0&&e.value!==null&&t.value.every((s,d)=>s.every((v,h)=>v===e.value.grid[d][h])));function J(s){if(!l.value)return;const{r:d,c:v}=l.value;s.key>="1"&&s.key<="9"?z(parseInt(s.key)):s.key==="0"||s.key==="Backspace"?D():s.key==="ArrowUp"||s.key==="w"||s.key==="W"?l.value={r:(d+8)%9,c:v}:s.key==="ArrowDown"||s.key==="s"||s.key==="S"?l.value={r:(d+1)%9,c:v}:s.key==="ArrowLeft"||s.key==="a"||s.key==="A"?l.value={r:d,c:(v+8)%9}:s.key==="ArrowRight"||s.key==="d"||s.key==="D"?l.value={r:d,c:(v+1)%9}:(s.ctrlKey||s.metaKey)&&s.key==="z"?$():(s.ctrlKey||s.metaKey)&&(s.key==="y"||s.shiftKey&&s.key==="Z")&&B()}return ee(()=>M()),(s,d)=>(b(),k("div",{class:"inline-block",onKeydown:d[0]||(d[0]=te(ne(()=>{},["prevent"]),["tab"])),onKeydownCapture:J,tabindex:"0"},[y("div",_e,[l.value?(b(),k("div",{key:0,class:"row-highlight bg-gray-400 opacity-10 absolute",style:I(X.value)},null,4)):E("",!0),l.value?(b(),k("div",{key:1,class:"col-highlight bg-gray-400 opacity-10 absolute",style:I(Y.value)},null,4)):E("",!0),y("div",we,[(b(!0),k(A,null,S(t.value,(v,h)=>(b(),k(A,{key:h},[(b(!0),k(A,null,S(v,(P,_)=>{var R,T;return b(),k("button",{key:_,onClick:$e=>W(h,_),class:oe(["border border-gray-400 flex items-center justify-center select-none","text-lg",h%3===0?"border-t-2":"",_%3===0?"border-l-2":"",h===8?"border-b-2":"",_===8?"border-r-2":"",((R=l.value)==null?void 0:R.r)===h&&((T=l.value)==null?void 0:T.c)===_?"bg-yellow-200":"",f.value[h][_]?"font-bold":"",o.showErrors&&m.value[h][_]?"bg-red-200":"",l.value&&t.value[l.value.r][l.value.c]!==0&&t.value[l.value.r][l.value.c]===P?"bg-blue-100":""])},V(P||""),11,xe)}),128))],64))),128))])]),y("div",Ae,[(b(),k(A,null,S(9,v=>y("button",{key:v,class:"p-2 bg-white border rounded",onClick:h=>z(v)},V(v),9,Me)),64)),y("button",{class:"p-2 bg-white border rounded",onClick:D},"消"),y("button",{class:"p-2 bg-white border rounded",onClick:$},"Undo"),y("button",{class:"p-2 bg-white border rounded",onClick:B},"Redo")]),Z.value?(b(),k("div",Ce,"完成！")):E("",!0)],32))}}),Se=ie(Ee,[["__scopeId","data-v-8daa9fb2"]]),Ve={class:"p-4"},je={class:"flex flex-wrap gap-2 items-center mb-4"},ze={class:"flex items-center gap-1"},De={class:"ml-auto text-sm flex items-center gap-1"},Re=G({__name:"sudoku",setup(i){const n=g("easy"),r=g(!0),o=g(""),u=g(null);function a(l){o.value=l.seed}function e(){var l;(l=u.value)==null||l.newGame()}function t(){document.documentElement.classList.toggle("dark")}async function f(){await navigator.clipboard.writeText(o.value)}return(l,c)=>(b(),k("div",Ve,[y("div",je,[K(y("select",{"onUpdate:modelValue":c[0]||(c[0]=p=>n.value=p),class:"border p-1"},c[2]||(c[2]=[se('<option value="easy">やさしい</option><option value="normal">ふつう</option><option value="hard">むずかしい</option><option value="expert">エキスパート</option><option value="oni">鬼</option>',5)]),512),[[le,n.value]]),y("button",{class:"border p-1",onClick:e},"新規作成"),y("label",ze,[K(y("input",{type:"checkbox","onUpdate:modelValue":c[1]||(c[1]=p=>r.value=p)},null,512),[[ae,r.value]]),c[3]||(c[3]=N(" エラーハイライト "))]),y("button",{class:"border p-1",onClick:t},"テーマ切替"),y("div",De,[N(" Seed: "+V(o.value)+" ",1),y("button",{class:"border px-1",onClick:f},"コピー")])]),re(Se,{ref_key:"board",ref:u,difficulty:n.value,"show-errors":r.value,onNew:a},null,8,["difficulty","show-errors"])]))}});export{Re as default};
